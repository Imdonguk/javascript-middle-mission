<script>
/*	
	## 함수명에 맞는 동작원리를 하자!!!!!!!!!!!!!
	## 쉽고 간단하게 코드를 짜자!!
	1. 코드흐름 : 
		(1)로또를 발행하는 함수를 만든다.
		(2)금액을 지불하면 1000원당 한장에 로또를 발행합니다.
			- 발행된 로또의 개수만큼 로또를 발행하는 함수를 호출시킵니다.
			- 발급된 로또는 모두 출력됩니다. 
		(3)로또 당첨번호가 나오면 발행했던 모든 로또와 비교하여 당첨통계를 출력해줍니다.
	2. 변수지정 : 
		(1) lottoData : 3개맞췄을 때부터 6개까지 데이터가 있고 거기에 해당하는 count 값과 당첨금액값이 있습니다.
		(2) pipe함수 : 함수의 값을 다른함수의 인자로 받고 또 함수의 값을 다른 함수의 인자로 받을 때 함수를 연결해주는 함수이다.
		(3) lottoObject : 로또 생성할 때 필요한 함수와 데이터가 들어있다.
			- insertMoney : 넣은 돈입니다.
			- createLotto : 로또를 생성해줍니다.
			- loopCount : 1000원당 한장을 발행하는데 발행하는 수를 반환합니다.
			- makeMyLottos : 돈을 넣은만큼 로또를 만들어줍니다.
			- printMyLotto : 발행한 모든 로또를 출력해줍니다.
			- confirmLottoWinning : 당첨번호와 나의 로또번호를 비교하여 당첨된 로또데이터를 반환합니다.
			- printLottoWinning : 당첨된 로또데이터를 토대로 당첨통계를 출력합니다.
		(4) buyLottos : 금액을 넣으면 1000원에 한장에 로또를 발행하고 출력합니다.
		(5) setLuckyNumber : 당첨번호가 나오면 내 로또번호와 비교하여 당첨통계를 출력합니다.
*/

/*
	* 객체 복사할 때 문제점.
	객체를 복사할 때 = 을 사용하면 같은 값을 참조하므로 데이터를 변경할 때 원본과 사본이 함께 변경됩니다.
	let a = {};
	let b = {};
	let c = {};
	>> 이럴 때는 a,b,c 모두 다른 객체를 참조하고 있습니다.
	a = b = c;
	>> 이렇게 되면 같은 객체를 참조하게 됩니다.

	- JSON.stringify : parse 메소드는 string 객체를 json 객체로 변환시켜줍니다.
	- JSON.parse : stringify 메소드는 json 객체를 String 객체로 변환시켜 줍니다.
	
	* 객체의 참조가 끊어질 때!!
	- 객체가 JSON문자열로 바뀔 때 객체의 참조가 끊어집니다.
*/
const lottoData = {
	3 : {count : 0, price : 5000},
	4 : {count : 0, price : 50000},
	5 : {count : 0, price : 1500000},
	6 : {count : 0, price : 2000000000}
}
/*
	## pipe함수
	function pipe(...fns){
		return function (value){
			return ...(func3(func2(func1(value))))
		}
	}
	우선 pipe함수에서 인자값으로 함수를 받는다. 첫번째 인자부터 순서대로 함수가 호출된다.
	첫번째 인자의 함수가 호출되고 함수의 반환값이 두번째 함수의 인자값으로 들어가고 호출되고 반환값이 세번째 함수의 인자값 이렇게 반복된다.
	그렇게 잘게 나누어진 함수들을 합쳐서 쓸 수가 있다.
	그리고 pipe함수가 window에 있기 때문에 pipe함수를 호출할 때 lottoObject객체 내에서 this가 lottoObject객체를 가리키지않고
	window를 가리켜서 당황을 했다. this를 써야하나 고민을 했었는데 call을 써서 window가 아니라 원하는 호출context를 정할 수 있었다.
*/
let pipe = (...fns) => (objName, value) => fns.reduce((acc, fn) => fn.call(objName, acc), value);

let lottoObject = {
	insertMoney : 0,
	createLotto(){
		const lottoArr = [];
		while(lottoArr.length !== 6){
			let ran = parseInt(Math.random() * 45 + 1);
			if(lottoArr.indexOf(ran) === -1) lottoArr.push(ran);
		}
		return lottoArr;
	},
	loopCount(insertMoney){
		this.insertMoney = insertMoney;
		let count = parseInt(insertMoney / 1000);
		return count;
	},
	makeMyLottos(count){

		let myLottos = [...Array(count)].map(v=>this.createLotto());
		this.myLottos = myLottos;
		return myLottos;
	},
	printMyLotto(myLottos){

		console.log(`${myLottos.length}개의 로또를 발행했습니다.`);

		myLottos.forEach(v=>{ console.log(v) })
	},
	confirmLottoWinning(luckyNumber){
		const copyLottoData = JSON.parse(JSON.stringify(lottoData));
		this.myLottos.forEach(v=>{
			let count = 0;
			v.forEach(value =>{
				if(luckyNumber.includes(value)) count++;
			});
			for(key in copyLottoData){
				if(+key === count) copyLottoData[key].count++;
			}
		})
		return copyLottoData;
	},
	printLottoWinning(winningData){
		let totalPrize = 0;
		console.log("당첨통계");
		console.log("-------------");
		for(let key in winningData){
			console.log(`${+key}개 일치 (${winningData[key].price}원) - ${winningData[key].count}개`);
			totalPrize += winningData[key].count * winningData[key].price;
		}
		let result = (totalPrize/this.insertMoney*100).toFixed(2);
		console.log(`나의 수익률은 ${result}%입니다.`);
	}

}

let buyLottos = pipe(lottoObject.loopCount, lottoObject.makeMyLottos, lottoObject.printMyLotto);
let setLuckyNumber = pipe(lottoObject.confirmLottoWinning, lottoObject.printLottoWinning);

buyLottos(lottoObject,50000);
setLuckyNumber(lottoObject, [1,2,3,4,5,6]);
</script>
